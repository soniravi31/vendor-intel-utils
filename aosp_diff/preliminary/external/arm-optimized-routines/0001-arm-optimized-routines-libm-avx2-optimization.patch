From 1308426bde4286bae7a27c7c1578eed8749a9187 Mon Sep 17 00:00:00 2001
From: "Soni, Ravi Kumar" <ravi.kumar.soni@intel.com>
Date: Wed, 18 Jan 2023 10:16:52 +0530
Subject: [PATCH] arm-optimized-routines libm avx2 optimization

Signed-off-by: Soni, Ravi Kumar <ravi.kumar.soni@intel.com>
---
 Android.bp  | 19 +++++++++++++++++++
 math/log.c  |  4 ++++
 math/logf.c |  2 ++
 3 files changed, 25 insertions(+)

diff --git a/Android.bp b/Android.bp
index 8fe656e..9c0708c 100755
--- a/Android.bp
+++ b/Android.bp
@@ -89,6 +89,25 @@ cc_library_static {
                 "-DHAVE_FAST_FMA=1",
             ],
         },
+        x86: {
+           exclude_srcs: [
+               "math/sinf.c",
+               "math/cosf.c",
+               "math/sincosf.c",
+               "math/log.c",
+               "math/logf.c",
+           ],
+        },
+	x86_64: {
+           exclude_srcs: [
+               "math/sinf.c",
+               "math/cosf.c",
+	       "math/sincosf.c",
+               "math/log.c",
+	       "math/logf.c",
+           ],
+
+	},
     },
 
     target: {
diff --git a/math/log.c b/math/log.c
index d3b7bc6..df12408 100644
--- a/math/log.c
+++ b/math/log.c
@@ -154,9 +154,13 @@ log (double x)
   return eval_as_double (y);
 }
 #if USE_GLIBC_ABI
+#ifndef REQUIRES_DISPATCH
 strong_alias (log, __log_finite)
 hidden_alias (log, __ieee754_log)
+#endif
+/*
 # if LDBL_MANT_DIG == 53
 long double logl (long double x) { return log (x); }
 # endif
+*/
 #endif
diff --git a/math/logf.c b/math/logf.c
index cfbaee1..64a0b8e 100644
--- a/math/logf.c
+++ b/math/logf.c
@@ -74,6 +74,8 @@ logf (float x)
   return eval_as_float (y);
 }
 #if USE_GLIBC_ABI
+#ifndef REQUIRES_DISPATCH
 strong_alias (logf, __logf_finite)
 hidden_alias (logf, __ieee754_logf)
 #endif
+#endif
-- 
2.25.1

